<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Households Consumption Expenditure Survey (HCES) Nutrition Data Analysis • hcesNutR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Households Consumption Expenditure Survey (HCES) Nutrition Data Analysis">
<meta property="og:description" content="Functions for analysing Nutrition analysis of HCES data. 
    The package contains functions for data cleaning, data manipulation, data visualisation and data analysis. The package also contains a dataset of the standard units and names of food items.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">hcesNutR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dzvoti/hcesR2/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div class="section level1">
<div class="page-header"><h1 id="hcesnutr-">hcesNutR <img src="reference/figures/logo.png" align="right" height="139" alt=""><a class="anchor" aria-label="anchor" href="#hcesnutr-"></a>
</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>The goal of hcesR is to create a package that will help with the analysis of the Household Consumption Expenditure Survey (HCES) data. A good source of HCES data is <a href="https://microdata.worldbank.org/" class="external-link">the world bank microdata repository</a>. The package will contain functions that will help with the analysis of HCES data. The package also contains a <a href="dzvoti.github.io/hcesNutR/data/sample_hces.dta">sample_hces.dta</a> used to demonstrate the use of the functions in the package, you can download this data after installing the package by running <code>hcesNutR::sample_hces()</code> in your R console. The package is still under development and will be updated regularly.</p>
</div>
<div class="section level1">
<h1 id="hcesnutr-package">
<code>hcesNutR</code> Package<a class="anchor" aria-label="anchor" href="#hcesnutr-package"></a>
</h1>
<p>The goal of the hcesNutR project is to create a repository of functions and data that will help with the analysis of the Household Consumption Expenditure Survey (HCES) data. A good source of HCES data is <a href="https://microdata.worldbank.org/" class="external-link">the world bank microdata repository</a>.</p>
<p>The package contain functions that will help with the analysis of HCES data. The package also contains the sample data used in this book i.e. <a href="dzvoti.github.io/hcesNutR/data/r4hces-data.zip">r4hces-data/mwi-ihs5-sample-data</a> We will use this sample data to demonstrate the use of the functions in the package. The package is still under development and will be updated regularly.</p>
<div class="section level2">
<h2 id="reporting-bugs">Reporting bugs<a class="anchor" aria-label="anchor" href="#reporting-bugs"></a>
</h2>
<p>Please report any bugs or issues <a href="www.github.com/dzvoti/hcesNutR/issues">here</a>.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of hcesNutR from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"dzvoti/hcesNutR"</span><span class="op">)</span></span></code></pre></div>
<p>As we discussed in previous chapters you need to load the package in your R session before you can use it. You can load the package by running the following code in your R console.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dzvoti/hcesR2" class="external-link">hcesNutR</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="functions-in-the-package">Functions in the package<a class="anchor" aria-label="anchor" href="#functions-in-the-package"></a>
</h2>
<p>You can view the functions in the package by running the following code in your R console.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="st">"package:hcesNutR"</span><span class="op">)</span></span></code></pre></div>
<div class="callout-tip">
<p>You can read the functions and their description on the project website at: <a href="dzvoti.github.io/hcesNutR/reference/index.html">dzvoti.github.io/hcesNutR/reference/index.html</a></p>
</div>
</div>
<div class="section level2">
<h2 id="sample-data">Sample data<a class="anchor" aria-label="anchor" href="#sample-data"></a>
</h2>
<p>The data used in this example is randomly generated to mimic the structure of the <a href="https://microdata.worldbank.org/index.php/catalog/3818/related-materials" class="external-link">Fifth Integrated Household Survey 2019-2020</a> an HCES of Malawi. The variables and structure of this data is found <a href="https://microdata.worldbank.org/index.php/catalog/3818/related-materials" class="external-link">here</a></p>
<div class="callout-tip">
<p>All functions in this package take a dataframe/tibble as input data. This is by design to allow flexibility on input data. The example used here is for use on stata files with <code>.dta</code> but the functions should work with <code>.csv</code> files as well.</p>
</div>
<div class="section level3">
<h3 id="import-and-explore-the-sample-data">Import and explore the sample data<a class="anchor" aria-label="anchor" href="#import-and-explore-the-sample-data"></a>
</h3>
<p>Import the sample data from the <code>r4hces-data/mwi-ihs5-sample-data</code> folder. Use the <code>read_dta</code> function from the <code>haven</code> package to import it.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import the data using the haven package from the tidyverse</span></span>
<span><span class="va">sample_hces</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_dta.html" class="external-link">read_dta</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"data"</span>, </span>
<span>                             <span class="st">"mwi-ihs5-sample-data"</span>,</span>
<span>                             <span class="st">"HH_MOD_G1_vMAPS.dta"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="trim-the-data">Trim the data<a class="anchor" aria-label="anchor" href="#trim-the-data"></a>
</h3>
<p>In this example we will use <code>hcesNutR</code> functions to demonstrate processing of <code>total</code> consumption data. The <code>total</code> consumption data is the data that contains the total consumption of each food item by each household.</p>
<p>The other consumption columns contain values for consumption from sources i.e. gifted, purchased, ownProduced. The workflow for processing the “other” consumption data is the same as demonstrated below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Trim the data to total consumption</span></span>
<span><span class="va">sample_hces</span> <span class="op">&lt;-</span> <span class="va">sample_hces</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">case_id</span><span class="op">:</span><span class="va">HHID</span>,</span>
<span>                <span class="va">hh_g01</span><span class="op">:</span><span class="va">hh_g03c_1</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="hcesnutr-workflow">
<code>hcesnutR</code> Workflow<a class="anchor" aria-label="anchor" href="#hcesnutr-workflow"></a>
</h2>
<div class="section level3">
<h3 id="column-naming-conventions-and-renaming">Column Naming Conventions and Renaming<a class="anchor" aria-label="anchor" href="#column-naming-conventions-and-renaming"></a>
</h3>
<p>The <code>sample_hces</code> data is in stata format which contains data with short column name codes that have associated “question” labels that explain the contents of the data. To make the column names more interpretable, the package provides the <code>rename_hces</code> function, which can be used to rename the column codes to standard hces names used downstream.</p>
<p>The <code>rename_hces</code> function uses column names from the <code>standard_name_mappings_pairs</code> dataset within the package. Alternatively, a user can create their own name pairs or manually rename their columns to the <code>standard</code> names.</p>
<p>It is important to note that all downstream functions in the <code>hcesNutR</code> package work with standard names and will not work with the short column names. Therefore, it is recommended to use the <code><a href="reference/rename_hces.html">rename_hces()</a></code> function to ensure that the column names are consistent with the package’s naming conventions.</p>
<p>For more information on how to use the <code>rename_hces</code> function, please refer to the function’s documentation: <a href="https://dzvoti.github.io/hcesNutR/reference/rename_hces.html" class="external-link"><code>rename_hces</code></a>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Rename the variables</span></span>
<span><span class="va">sample_hces</span> <span class="op">&lt;-</span> <span class="fu">hcesNutR</span><span class="fu">::</span><span class="fu"><a href="reference/rename_hces.html">rename_hces</a></span><span class="op">(</span><span class="va">sample_hces</span>,</span>
<span>                                     country_name <span class="op">=</span> <span class="st">"MWI"</span>,</span>
<span>                                     survey_name <span class="op">=</span> <span class="st">"IHS5"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="remove-unconsumed-food-items">Remove unconsumed food items<a class="anchor" aria-label="anchor" href="#remove-unconsumed-food-items"></a>
</h3>
<p>HCES surveys administer a standard questionaire to each household where they are asked to conform whether they consumed the food items on their standard list. If a household did not consume a food item, the value of the ‘consYN’ is set to a constant. The <code>remove_unconsumed</code> function removes all food items that were not consumed by the household. The function takes in a data frame and the name of the column that contains the consumption information. The function also takes in the value that indicates that the food item was consumed.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove unconsumed food items</span></span>
<span><span class="va">sample_hces</span> <span class="op">&lt;-</span> <span class="fu">hcesNutR</span><span class="fu">::</span><span class="fu"><a href="reference/remove_unconsumed.html">remove_unconsumed</a></span><span class="op">(</span><span class="va">sample_hces</span>,</span>
<span>                                           consCol <span class="op">=</span> <span class="st">"consYN"</span>, </span>
<span>                                           consVal <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-two-columns-from-each-dbllbl-column">Create two columns from each dbl+lbl column<a class="anchor" aria-label="anchor" href="#create-two-columns-from-each-dbllbl-column"></a>
</h3>
<p>The <code>create_dta_labels</code> function creates two columns from each dbl+lbl (double plus label) column. The first column contains the numeric values and the second column contains the labels. The function takes in a data frame and finds all columns that contains the double plus label column. The function returns a data frame with the new columns.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Split dbl+lbl columns</span></span>
<span><span class="va">sample_hces</span> <span class="op">&lt;-</span> <span class="fu">hcesNutR</span><span class="fu">::</span><span class="fu"><a href="reference/create_dta_labels.html">create_dta_labels</a></span><span class="op">(</span><span class="va">sample_hces</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="concatenate-columns">Concatenate columns<a class="anchor" aria-label="anchor" href="#concatenate-columns"></a>
</h3>
<p>Some HCES data surveys split consumed food items or their consumption units into multiple columns. The <code>concatenate_columns</code> function cleans the data by combining the split columns into one column. The function can exclude values from contatenation by specifying the whole or part of values to be excluded.</p>
<div class="section level4">
<h4 id="concatenate-food-item-names">Concatenate food item names<a class="anchor" aria-label="anchor" href="#concatenate-food-item-names"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Merge food item names</span></span>
<span><span class="va">sample_hces</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">hcesNutR</span><span class="fu">::</span><span class="fu"><a href="reference/concatenate_columns.html">concatenate_columns</a></span><span class="op">(</span><span class="va">sample_hces</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"item_code_name"</span>, </span>
<span>                                  <span class="st">"item_oth"</span><span class="op">)</span>,</span>
<span>                                <span class="st">"SPECIFY"</span>,</span>
<span>                                <span class="st">"item_code_name"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="concatenate-food-item-units">Concatenate food item units<a class="anchor" aria-label="anchor" href="#concatenate-food-item-units"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Merge consumption unit names. For units it is essential to remove parentesis as they are the major cause of duplicate units</span></span>
<span><span class="va">sample_hces</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">hcesNutR</span><span class="fu">::</span><span class="fu"><a href="reference/concatenate_columns.html">concatenate_columns</a></span><span class="op">(</span></span>
<span>    <span class="va">sample_hces</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"cons_unit_name"</span>,</span>
<span>      <span class="st">"cons_unit_oth"</span>,</span>
<span>      <span class="st">"cons_unit_size_name"</span>,</span>
<span>      <span class="st">"hh_g03c_1_name"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="st">"SPECIFY"</span>,</span>
<span>    <span class="st">"cons_unit_name"</span>,</span>
<span>    <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="callout-tip">
<p>Use the <code>select</code> and <code>rename</code> functions from the dplyr package to subset the columns containing food item name , food item code, food unit name and food unit code. This is to ensure that the names are meaningful and consistent with the package’s naming conventions.</p>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_hces</span> <span class="op">&lt;-</span> <span class="va">sample_hces</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">case_id</span>,</span>
<span>    <span class="va">hhid</span>,</span>
<span>    <span class="va">item_code_name</span>,</span>
<span>    <span class="va">item_code_code</span>,</span>
<span>    <span class="va">cons_unit_name</span>,</span>
<span>    <span class="va">cons_unitA</span>,</span>
<span>    <span class="va">cons_quant</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>food_name <span class="op">=</span> <span class="va">item_code_name</span>,</span>
<span>                food_code <span class="op">=</span> <span class="va">item_code_code</span>,</span>
<span>                cons_unit_code <span class="op">=</span> <span class="va">cons_unitA</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="match-survey-food-items-to-standard-food-items">Match survey food items to standard food items<a class="anchor" aria-label="anchor" href="#match-survey-food-items-to-standard-food-items"></a>
</h3>
<p>The <code>match_food_names</code> function is useful for standardising survey food names. This is feasible due to an internal dataset of standard food item names matched with their corresponding survey food names for supported surveys. Alternatively users can use their own food matching names by passing a csv to the function. See hcesNutR::food_list for csv structure.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_hces</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="reference/match_food_names_v2.html">match_food_names_v2</a></span><span class="op">(</span></span>
<span>    <span class="va">sample_hces</span>,</span>
<span>    country <span class="op">=</span> <span class="st">"MWI"</span>,</span>
<span>    survey <span class="op">=</span> <span class="st">"IHS5"</span>,</span>
<span>    food_name_col <span class="op">=</span> <span class="st">"food_name"</span>,</span>
<span>    food_code_col <span class="op">=</span> <span class="st">"food_code"</span>,</span>
<span>    overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="match-survey-consumption-units-to-standard-consumption-units">Match survey consumption units to standard consumption units<a class="anchor" aria-label="anchor" href="#match-survey-consumption-units-to-standard-consumption-units"></a>
</h3>
<p>The <code>match_food_units_v2</code> function is useful for standardising survey consumption units. This is feasible due to an internal dataset of standard consumption units matched with their corresponding survey consumption units for supported surveys. Alternatively users can download our template from <code><a href="reference/unit_names_n_codes_df.html">hcesNutR::unit_names_n_codes_df</a></code> and modify it to use their own consumption unit matching names.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_hces</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="reference/match_food_units_v2.html">match_food_units_v2</a></span><span class="op">(</span></span>
<span>    <span class="va">sample_hces</span>,</span>
<span>    country <span class="op">=</span> <span class="st">"MWI"</span>,</span>
<span>    survey <span class="op">=</span> <span class="st">"IHS5"</span>,</span>
<span>    unit_name_col <span class="op">=</span> <span class="st">"cons_unit_name"</span>,</span>
<span>    unit_code_col <span class="op">=</span> <span class="st">"cons_unit_code"</span>,</span>
<span>    matches_csv <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="add-regions-and-districts-to-the-data">Add regions and districts to the data<a class="anchor" aria-label="anchor" href="#add-regions-and-districts-to-the-data"></a>
</h3>
<p>Identify the HCES module that contains <code>household identifiers</code>. In some cases this will already be present in the HCES data and should be skipped. From the <code>household identifiers</code> select the ones that are required and add to the data. In this example we will add the region and district identifiers to the data from the <code>hh_mod_a_filt.dta</code> file.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import household identifiers from the hh_mod_a_filt.dta file</span></span>
<span><span class="va">household_identifiers</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_dta.html" class="external-link">read_dta</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"data"</span>,</span>
<span>                             <span class="st">"mwi-ihs5-sample-data"</span>,</span>
<span>                             <span class="st">"hh_mod_a_filt_vMAPS.dta"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># subset the identifiers and keep only the ones needed.</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">case_id</span>,</span>
<span>                <span class="va">HHID</span>,</span>
<span>                <span class="va">region</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>hhid <span class="op">=</span> <span class="va">HHID</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add the identifiers to the data</span></span>
<span><span class="va">sample_hces</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">sample_hces</span>,</span>
<span>                   <span class="va">household_identifiers</span>,</span>
<span>                   by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hhid"</span>, <span class="st">"case_id"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-a-measure_id-column">Create a <code>measure_id</code> column<a class="anchor" aria-label="anchor" href="#create-a-measure_id-column"></a>
</h3>
<p>The <code>create_measure_id</code> function creates a measure id column that is used to identify the consumption measure of each food item. The function takes in a data frame and the name of the column that contains the consumption information. The function also takes in the value that indicates that the food item was consumed.</p>
<p>The <code>measure_id</code> is a unique identifier that allows us to join the consumption data with the food conversion factors data.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create measure id column</span></span>
<span><span class="va">sample_hces</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="reference/create_measure_id.html">create_measure_id</a></span><span class="op">(</span></span>
<span>    <span class="va">sample_hces</span>,</span>
<span>    country <span class="op">=</span> <span class="st">"MWI"</span>,</span>
<span>    survey <span class="op">=</span> <span class="st">"IHS5"</span>,</span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"region"</span>,</span>
<span>             <span class="st">"matched_cons_unit_code"</span>,</span>
<span>             <span class="st">"matched_food_code"</span><span class="op">)</span>,</span>
<span>    include_ISOs <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="import-food-conversion-factors">Import food conversion factors.<a class="anchor" aria-label="anchor" href="#import-food-conversion-factors"></a>
</h3>
<p>The available data comes with a `food_conversion fcators file which has conversion fcators that link the food names and units to their corresponding</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import food conversion factors file</span></span>
<span><span class="va">IHS5_conv_fct</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span></span>
<span>    <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span></span>
<span>      <span class="st">"data"</span>,</span>
<span>      <span class="st">"mwi-ihs5-sample-data"</span>,</span>
<span>      <span class="st">"IHS5_UNIT_CONVERSION_FACTORS_vMAPS.csv"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We need to check if the conversion factors file contain all the expected conversion factors for the hces data being processed. The <code>check_conv_fct</code> function checks if the conversion factors file contains all the expected conversion factors for the hces data being processed. T</p>
<div class="callout-warning">
<p>Remember this data was randomly generated so it is expected that the weights will not be realistic. Also not all food items have conversion factors so the weight of those food items will be <code>NA</code>.</p>
</div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check conversion factors </span></span>
<span><span class="fu"><a href="reference/check_conv_fct.html">check_conv_fct</a></span><span class="op">(</span>hces_df <span class="op">=</span> <span class="va">sample_hces</span>, </span>
<span>               conv_fct_df <span class="op">=</span> <span class="va">IHS5_conv_fct</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculate-weight-of-food-items-in-kilograms">Calculate weight of food items in kilograms.<a class="anchor" aria-label="anchor" href="#calculate-weight-of-food-items-in-kilograms"></a>
</h3>
<p>The <code>apply_wght_conv_fct</code> function will take the <code>hces_df</code> and <code>conv_fct_df</code> and calculate the weight of each food item in kilograms.</p>
<div class="callout-warning">
<p>Remember this data was randomly generated so it is expected that the weights will not be realistic. Also not all food items have conversion factors so the weight of those food items will be <code>NA</code>.</p>
</div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_hces</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="reference/apply_wght_conv_fct.html">apply_wght_conv_fct</a></span><span class="op">(</span></span>
<span>    hces_df <span class="op">=</span> <span class="va">sample_hces</span>,</span>
<span>    conv_fct_df <span class="op">=</span> <span class="va">IHS5_conv_fct</span>,</span>
<span>    factor_col <span class="op">=</span> <span class="st">"factor"</span>,</span>
<span>    measure_id_col <span class="op">=</span> <span class="st">"measure_id"</span>,</span>
<span>    wt_kg_col <span class="op">=</span> <span class="st">"wt_kg"</span>,</span>
<span>    cons_qnty_col <span class="op">=</span> <span class="st">"cons_quant"</span>,</span>
<span>    allowDuplicates <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculate-afeame-and-add-to-the-data">Calculate AFE/AME and add to the data<a class="anchor" aria-label="anchor" href="#calculate-afeame-and-add-to-the-data"></a>
</h3>
</div>
</div>
<div class="section level2 callout-tip">
<h2 id="assumptions">Assumptions<a class="anchor" aria-label="anchor" href="#assumptions"></a>
</h2>
<p>The ame/afe factors are calculated using the following assumptions: - Merge HH demographic data with AME/AFE factors - Men’s weight: 65kg (assumption) - Women’s weight: 55kg (from DHS) - PAL: 1.6X the BMR</p>
</div>
<div class="section level4">
<h4 id="import-data-required">Import data required<a class="anchor" aria-label="anchor" href="#import-data-required"></a>
</h4>
<p>In order to calculate the AFE and AME metrics we require the following data: - Household roster with the sex and age of each individual <code>HH_MOD_B_vMAPS.dta</code> - Household health <code>HH_MOD_D_vMAPS.dta</code> - AFE and AME factors <code>IHS5_AME_FACTORS_vMAPS.csv</code> and <code>IHS5_AME_SPEC_vMAPS.csv</code></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import data of the roster and health modules of the IHS5 survey</span></span>
<span><span class="va">ihs5_roster</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_dta.html" class="external-link">read_dta</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"data"</span>,</span>
<span>                             <span class="st">"mwi-ihs5-sample-data"</span>,</span>
<span>                             <span class="st">"HH_MOD_B_vMAPS.dta"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ihs5_health</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_dta.html" class="external-link">read_dta</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"data"</span>,</span>
<span>                             <span class="st">"mwi-ihs5-sample-data"</span>,</span>
<span>                             <span class="st">"HH_MOD_D_vMAPS.dta"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Import data of the AME/AFE factors and specifications</span></span>
<span><span class="va">ame_factors</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"data"</span>,</span>
<span>                      <span class="st">"mwi-ihs5-sample-data"</span>,</span>
<span>                      <span class="st">"IHS5_AME_FACTORS_vMAPS.csv"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ame_spec_factors</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"data"</span>,</span>
<span>                      <span class="st">"mwi-ihs5-sample-data"</span>,</span>
<span>                      <span class="st">"IHS5_AME_SPEC_vMAPS.csv"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Rename the population column to cat and select the relevant columns</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>cat <span class="op">=</span> <span class="va">population</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">cat</span>, <span class="va">ame_spec</span>, <span class="va">afe_spec</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="extra-energy-requirements-for-pregnancy">Extra energy requirements for pregnancy<a class="anchor" aria-label="anchor" href="#extra-energy-requirements-for-pregnancy"></a>
</h4>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extra energy requirements for pregnancy and Illness</span></span>
<span><span class="va">pregnantPersons</span> <span class="op">&lt;-</span> <span class="va">ihs5_health</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">hh_d05a</span> <span class="op">==</span> <span class="fl">28</span> <span class="op">|</span></span>
<span>                  <span class="va">hh_d05b</span> <span class="op">==</span> <span class="fl">28</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># NOTE: 28 is the code for pregnancy in this survey</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ame_preg <span class="op">=</span> <span class="fl">0.11</span>, afe_preg <span class="op">=</span> <span class="fl">0.14</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">HHID</span>, <span class="va">ame_preg</span>, <span class="va">afe_preg</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="process-hh-roster-data">Process HH roster data<a class="anchor" aria-label="anchor" href="#process-hh-roster-data"></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Process the roster data and rename variables to be more intuitive</span></span>
<span><span class="va">aMFe_summaries</span> <span class="op">&lt;-</span> <span class="va">ihs5_roster</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Rename the variables to be more intuitive</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>sex <span class="op">=</span> <span class="va">hh_b03</span>, age_y <span class="op">=</span> <span class="va">hh_b05a</span>, age_m <span class="op">=</span> <span class="va">hh_b05b</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_m_total <span class="op">=</span> <span class="op">(</span><span class="va">age_y</span> <span class="op">*</span> <span class="fl">12</span> <span class="op">+</span> <span class="va">age_m</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Add the AME/AFE factors to the roster data</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">ame_factors</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age_y"</span> <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ame_base <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="va">ame_m</span>, <span class="va">sex</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="va">ame_f</span><span class="op">)</span>,</span>
<span>    afe_base <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="va">afe_m</span>, <span class="va">sex</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="va">afe_f</span><span class="op">)</span>,</span>
<span>    age_u1_cat <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="co"># NOTE: Round here will ensure that decimals are not omited in the calculation.</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">age_m_total</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">0</span><span class="op">:</span><span class="fl">5</span> <span class="op">~</span> <span class="st">"0-5 months"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">age_m_total</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">6</span><span class="op">:</span><span class="fl">8</span> <span class="op">~</span> <span class="st">"6-8 months"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">age_m_total</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">9</span><span class="op">:</span><span class="fl">11</span> <span class="op">~</span> <span class="st">"9-11 months"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Add the AME/AFE factors for the specific age categories</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">ame_spec_factors</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age_u1_cat"</span> <span class="op">=</span> <span class="st">"cat"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Dietary requirements for children under 1 year old</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ame_lac <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">age_y</span> <span class="op">&lt;</span> <span class="fl">2</span> <span class="op">~</span> <span class="fl">0.19</span><span class="op">)</span>,</span>
<span>    afe_lac <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">age_y</span> <span class="op">&lt;</span> <span class="fl">2</span> <span class="op">~</span> <span class="fl">0.24</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># TODO: Will it not be better to have the pregnancy values added at the same time here?</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ame <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ame_base</span>, <span class="va">ame_spec</span>, <span class="va">ame_lac</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                afe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">afe_base</span>, <span class="va">afe_spec</span>, <span class="va">afe_lac</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Calculate number of individuals in the households</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">HHID</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    hh_persons <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    hh_ame <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ame</span><span class="op">)</span>,</span>
<span>    hh_afe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">afe</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Merge with the pregnancy and illness data</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">pregnantPersons</span>, by <span class="op">=</span> <span class="st">"HHID"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>hh_ame <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">hh_ame</span>, <span class="va">ame_preg</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>                hh_afe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">hh_afe</span>, <span class="va">afe_preg</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Fix single household factors</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    hh_ame <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">hh_persons</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="va">hh_ame</span><span class="op">)</span>,</span>
<span>    hh_afe <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">hh_persons</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="va">hh_afe</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">HHID</span>, <span class="va">hh_persons</span>, <span class="va">hh_ame</span>, <span class="va">hh_afe</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>hhid <span class="op">=</span> <span class="va">HHID</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="enrich-consumption-data-with-afeame">Enrich Consumption Data with AFE/AME<a class="anchor" aria-label="anchor" href="#enrich-consumption-data-with-afeame"></a>
</h4>
<p>We will use the <code>left_join</code> function from <code>dplyr</code> to join the consumption data with the <code>aMFe_summaries</code> data.</p>
<p>The <code>left_join</code> function will join the <code>aMFe_summaries</code> data to the <code>sample_hces</code> data by matching the <code>hhid</code> column in both data sets.</p>
<p>The <code>left_join</code> function will add the <code>hh_persons</code>, <code>hh_ame</code> and <code>hh_afe</code> columns to the <code>sample_hces</code> data.</p>
<p>The <code>hh_persons</code> column contains the number of people in each household. The <code>hh_ame</code> and <code>hh_afe</code> columns contain the AME and AFE factors for each household.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_hces</span> <span class="op">&lt;-</span> <span class="va">sample_hces</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">aMFe_summaries</span><span class="op">)</span></span></code></pre></div>
<p>Now we have a “clean” data set that we can use for analysis.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>This chapter demonstrated the use of the <code>hcesNutR</code> package to process HCES data. The package contains functions that will help with the analysis of HCES data.</p>
<p>The package also contains the sample data used in this book i.e. <a href="dzvoti.github.io/hcesNutR/data/r4hces-data.zip">r4hces-data/mwi-ihs5-sample-data</a> We used this sample data to demonstrate the use of the functions in the package.</p>
<p>The package is still under development and will be updated regularly.Please report any bugs or issues <a href="www.github.com/dzvoti/hcesNutR/issues">here</a>.</p>
</div>
<div class="section level2">
<h2 id="future-work">Future work<a class="anchor" aria-label="anchor" href="#future-work"></a>
</h2>
<ul>
<li>Add more functions to the package</li>
<li>Support more surveys (NGA Living Standards Survey 2018-2019)</li>
<li>Add more internal data to the package</li>
<li>Add more documentation to the package</li>
</ul>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/dzvoti/hcesR2/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/dzvoti/hcesR2/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing hcesNutR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Liberty Mlambo <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-3740-1345" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Gareth Osman <br><small class="roles"> Author, contributor </small> <a href="https://orcid.org/-" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Kevin Tang <br><small class="roles"> Author, contributor </small> <a href="https://orcid.org/-" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Lucia Segovia de la Revilla <br><small class="roles"> Author, contributor </small> <a href="https://orcid.org/-" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Louise E. Ander <br><small class="roles"> Author, contributor </small> <a href="https://orcid.org/-" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Micronutrient Action Policy Support (MAPS) Project <br><small class="roles"> Copyright holder, funder </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Liberty Mlambo, Gareth Osman, Kevin Tang, Lucia Segovia de la Revilla, Louise E. Ander, Micronutrient Action Policy Support (MAPS) Project.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
